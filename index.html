<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f4f4f4;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }
        .navbar {
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            padding: 10px;
        }
        .content {
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .hidden {
            display: none;
        }
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="#" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#" onclick="showSection('classrooms')">Classrooms</a>
        <a href="#" onclick="showSection('students')">Students</a>
        <a href="#" onclick="showSection('quizzes')">Quizzes</a>
        <a href="#" onclick="showSection('grades')">Grades</a>
        <a href="#" onclick="showSection('export')">Export</a>
    </div>

    <!-- Previous sections remain the same -->
    <!-- Add this new Export section after the Grades section -->
    <div id="export" class="content hidden">
        <h1>Export Data</h1>
        <div class="export-buttons">
            <button onclick="exportToCSV('classrooms')">Export Classrooms</button>
            <button onclick="exportToCSV('students')">Export Students</button>
            <button onclick="exportToCSV('quizzes')">Export Quizzes</button>
            <button onclick="exportToCSV('grades')">Export Grades</button>
        </div>
    </div>

    <!-- Rest of the previous HTML remains the same -->

    <script>
        // ... (previous script remains the same)

        // CSV Export Function
        function exportToCSV(dataType) {
            let data, filename, headers;

            // Select the appropriate data and headers
            switch(dataType) {
                case 'classrooms':
                    data = classrooms;
                    headers = ['ID', 'Name', 'Subject'];
                    filename = 'classrooms.csv';
                    break;
                case 'students':
                    data = students.map(student => {
                        const classroom = classrooms.find(c => c.id == student.classroomId);
                        return {
                            ...student,
                            classroomName: classroom ? classroom.name : 'Unassigned'
                        };
                    });
                    headers = ['ID', 'Name', 'Classroom ID', 'Classroom Name'];
                    filename = 'students.csv';
                    break;
                case 'quizzes':
                    data = quizzes.map(quiz => {
                        const classroom = classrooms.find(c => c.id == quiz.classroomId);
                        return {
                            ...quiz,
                            classroomName: classroom ? classroom.name : 'Unassigned'
                        };
                    });
                    headers = ['ID', 'Title', 'Classroom ID', 'Classroom Name', 'Time Limit'];
                    filename = 'quizzes.csv';
                    break;
                case 'grades':
                    data = grades.map(grade => {
                        const student = students.find(s => s.id == grade.studentId);
                        const quiz = quizzes.find(q => q.id == grade.quizId);
                        return {
                            ...grade,
                            studentName: student ? student.name : 'Unknown',
                            quizTitle: quiz ? quiz.title : 'Unknown'
                        };
                    });
                    headers = ['ID', 'Student ID', 'Student Name', 'Quiz ID', 'Quiz Title', 'Score'];
                    filename = 'grades.csv';
                    break;
                default:
                    return;
            }

            // Convert data to CSV
            const csvContent = [
                headers.join(','),
                ...data.map(item => 
                    headers.map(header => {
                        // Escape commas and quotes in the values
                        const value = item[header.toLowerCase()] || item[header.replace(/\s/g, '').toLowerCase()];
                        const escapedValue = value !== undefined 
                            ? `"${String(value).replace(/"/g, '""')}"` 
                            : '""';
                        return escapedValue;
                    }).join(',')
                )
            ].join('\n');

            // Create and download the CSV file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Add this to the existing script
        // Initial setup
        document.addEventListener('DOMContentLoaded', loadDataFromLocalStorage);
        showSection('dashboard');
    </script>
</body>
</html>
