<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Management System</title>
    <style>
        /* Previous CSS remains the same */
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .clear-data-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="#" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#" onclick="showSection('classrooms')">Classrooms</a>
        <a href="#" onclick="showSection('students')">Students</a>
        <a href="#" onclick="showSection('quizzes')">Quizzes</a>
        <a href="#" onclick="showSection('grades')">Grades</a>
    </div>

    <div class="container">
        <!-- Previous HTML content remains the same -->
        
        <!-- Add Clear Data Button to Dashboard -->
        <div id="dashboard" class="content">
            <h1>Dashboard</h1>
            <div id="dashboardStats">
                <p>Total Classrooms: <span id="totalClassrooms">0</span></p>
                <p>Total Students: <span id="totalStudents">0</span></p>
                <p>Total Quizzes: <span id="totalQuizzes">0</span></p>
            </div>
            <button onclick="clearAllData()" class="clear-data-btn">Clear All Data</button>
        </div>
    </div>

    <script>
        // Local Storage Utility Functions
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error('Error saving to local storage:', error);
                if (error instanceof DOMException && error.name === 'QuotaExceededError') {
                    alert('Local storage is full. Please clear some data.');
                }
            }
        }

        function loadFromLocalStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Error loading from local storage:', error);
                return defaultValue;
            }
        }

        // Clear All Data Function
        function clearAllData() {
            const confirmClear = confirm('Are you sure you want to clear ALL data? This cannot be undone.');
            if (confirmClear) {
                localStorage.clear();
                // Reset global arrays
                classrooms = [];
                students = [];
                quizzes = [];
                grades = [];

                // Re-render all lists
                renderClassrooms();
                renderStudents();
                renderQuizzes();
                renderGrades();
                updateDashboard();

                alert('All data has been cleared.');
            }
        }

        // Global storage with local storage initialization
        let classrooms = loadFromLocalStorage('classrooms');
        let students = loadFromLocalStorage('students');
        let quizzes = loadFromLocalStorage('quizzes');
        let grades = loadFromLocalStorage('grades');

        // Modify existing functions to use local storage
        // Classroom Management
        function renderClassrooms() {
            const list = document.getElementById('classroomList');
            list.innerHTML = '';
            
            classrooms.forEach(classroom => {
                const row = list.insertRow();
                row.innerHTML = `
                    <td>${classroom.name}</td>
                    <td>${classroom.subject}</td>
                    <td class="action-buttons">
                        <button onclick="deleteClassroom(${classroom.id})">Delete</button>
                    </td>
                `;
            });
            
            // Persist to local storage
            saveToLocalStorage('classrooms', classrooms);
        }

        function deleteClassroom(id) {
            classrooms = classrooms.filter(c => c.id !== id);
            renderClassrooms();
            updateDashboard();
        }

        // Existing form submit handler for classrooms
        document.getElementById('classroomForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('classroomName').value;
            const subject = document.getElementById('classroomSubject').value;
            
            const classroom = { id: Date.now(), name, subject };
            classrooms.push(classroom);
            
            renderClassrooms();
            updateDashboard();
            
            // Clear form
            document.getElementById('classroomName').value = '';
            document.getElementById('classroomSubject').value = '';
        });

        // Similar modifications for other sections (students, quizzes, grades)
        function renderStudents() {
            const list = document.getElementById('studentList');
            list.innerHTML = '';
            
            students.forEach(student => {
                const classroom = classrooms.find(c => c.id == student.classroomId);
                const row = list.insertRow();
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${classroom ? classroom.name : 'Unassigned'}</td>
                    <td class="action-buttons">
                        <button onclick="deleteStudent(${student.id})">Delete</button>
                    </td>
                `;
            });
            
            // Persist to local storage
            saveToLocalStorage('students', students);
        }

        function deleteStudent(id) {
            students = students.filter(s => s.id !== id);
            renderStudents();
            updateDashboard();
        }

        function renderQuizzes() {
            const list = document.getElementById('quizList');
            list.innerHTML = '';
            
            quizzes.forEach(quiz => {
                const classroom = classrooms.find(c => c.id == quiz.classroomId);
                const row = list.insertRow();
                row.innerHTML = `
                    <td>${quiz.title}</td>
                    <td>${classroom ? classroom.name : 'Unassigned'}</td>
                    <td>${quiz.timeLimit}</td>
                    <td class="action-buttons">
                        <button onclick="deleteQuiz(${quiz.id})">Delete</button>
                    </td>
                `;
            });
            
            // Persist to local storage
            saveToLocalStorage('quizzes', quizzes);
        }

        function deleteQuiz(id) {
            quizzes = quizzes.filter(q => q.id !== id);
            renderQuizzes();
            updateDashboard();
        }

        function renderGrades() {
            const list = document.getElementById('gradeList');
            list.innerHTML = '';
            
            grades.forEach(grade => {
                const student = students.find(s => s.id == grade.studentId);
                const quiz = quizzes.find(q => q.id == grade.quizId);
                
                const row = list.insertRow();
                row.innerHTML = `
                    <td>${student ? student.name : 'Unknown'}</td>
                    <td>${quiz ? quiz.title : 'Unknown'}</td>
                    <td>${grade.score}</td>
                `;
            });
            
            // Persist to local storage
            saveToLocalStorage('grades', grades);
        }

        // Existing form submit handlers for students, quizzes, and grades 
        // will need similar local storage persistence (add saveToLocalStorage calls)

        // Remaining existing script remains the same
        // ... (previous script content)

        // Initial render and dashboard update
        renderClassrooms();
        renderStudents();
        renderQuizzes();
        renderGrades();
        updateDashboard();
    </script>
</body>
</html>
